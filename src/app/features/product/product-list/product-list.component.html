<div class="container mx-auto px-4 py-8">
  <!-- Category Header -->
  <div class="mb-8 text-center">
    <h1 class="text-3xl md:text-4xl font-bold mb-2 capitalize">
      {{ categoryTitle }}
    </h1>
    <p class="text-gray-600">{{ getDescription() }}</p>
  </div>

  <!-- Filters and Sort -->
  <div class="mb-8 p-4 bg-gray-50">
    <div
      class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4"
    >
      <!-- Sort -->
      <!-- <div class="w-full md:w-auto">
        <p-select
          [options]="sortOptions"
          [(ngModel)]="selectedSortOption"
          (onChange)="onSortChange()"
          placeholder="Sort By"
          [style]="{ 'min-width': '200px' }"
          styleClass="w-full md:w-auto"
        ></p-select>
      </div> -->

      <!-- View Toggle -->
      <div class="flex gap-2">
        <!-- <button
          (click)="viewMode = 'grid'"
          [ngClass]="{
            'bg-purple-600 text-white': viewMode === 'grid',
            'bg-gray-200 text-gray-600': viewMode !== 'grid'
          }"
          class="p-2 transition-colors"
        >
          <i class="pi pi-th-large"></i>
        </button> -->
        <!-- <button
          (click)="viewMode = 'list'"
          [ngClass]="{
            'bg-purple-600 text-white': viewMode === 'list',
            'bg-gray-200 text-gray-600': viewMode !== 'list'
          }"
          class="p-2 transition-colors"
        >
          <i class="pi pi-list"></i>
        </button> -->
      </div>

      <!-- Filter Button (Mobile) -->
      <button
        (click)="showFilters = !showFilters"
        class="md:hidden bg-gray-200 hover:bg-gray-300 text-gray-800 px-4 py-2 transition-colors w-full flex justify-center items-center gap-2"
      >
        <i class="pi pi-filter"></i> Filters
        <i
          [ngClass]="showFilters ? 'pi-chevron-up' : 'pi-chevron-down'"
          class="pi"
        ></i>
      </button>
    </div>

    <!-- Filters (expandable on mobile) -->
    <div
      [ngClass]="{ 'hidden md:block': !showFilters, block: showFilters }"
      class="mt-4 md:mt-6"
    >
      <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
        <!-- Price Range -->
        <div>
          <h3 class="font-medium mb-3">Price Range</h3>
          <p-slider
            [(ngModel)]="priceRange"
            [range]="true"
            [min]="0"
            [max]="1000"
            (onSlideEnd)="applyFilters()"
            class="w-full"
          ></p-slider>
          <div class="flex justify-between mt-2 text-sm text-gray-600">
            <span>${{ priceRange[0] }}</span>
            <span>${{ priceRange[1] }}</span>
          </div>
        </div>

        <!-- Colors -->
        <div>
          <h3 class="font-medium mb-3">Colors</h3>
          <div class="flex flex-wrap gap-2">
            <div
              *ngFor="let color of availableColors"
              (click)="toggleColorFilter(color)"
              [ngClass]="{
                'border-2 border-purple-600': selectedColors().includes(color)
              }"
              class="w-6 h-6 cursor-pointer"
              [style]="{ 'background-color': color }"
            ></div>
          </div>
        </div>

        <!-- Sizes -->
        <div>
          <h3 class="font-medium mb-3">Sizes</h3>
          <div class="flex flex-wrap gap-2">
            <div
              *ngFor="let size of availableSizes"
              (click)="toggleSizeFilter(size)"
              [ngClass]="{
                'bg-purple-600 text-white': selectedSizes().includes(size),
                'bg-gray-200 text-gray-700': !selectedSizes().includes(size)
              }"
              class="px-3 py-1 text-sm cursor-pointer transition-colors"
            >
              {{ size }}
            </div>
          </div>
        </div>
      </div>

      <!-- Applied Filters -->
      <div
        *ngIf="hasActiveFilters()"
        class="mt-4 flex flex-wrap items-center gap-2"
      >
        <span class="text-sm text-gray-600">Active filters:</span>
        <div
          *ngIf="priceRange[0] > 0 || priceRange[1] < 1000"
          class="bg-gray-100 text-gray-800 text-sm px-2 py-1 flex items-center gap-1"
        >
          Price: ${{ priceRange[0] }} - ${{ priceRange[1] }}
          <button
            (click)="resetPriceFilter()"
            class="text-gray-500 hover:text-gray-700"
          >
            <i class="pi pi-times"></i>
          </button>
        </div>
        <div
          *ngFor="let color of selectedColors()"
          class="bg-gray-100 text-gray-800 text-sm px-2 py-1 flex items-center gap-1"
        >
          <span
            class="w-3 h-3 inline-block"
            [style]="{ 'background-color': color }"
          ></span>
          {{ color }}
          <button
            (click)="toggleColorFilter(color)"
            class="text-gray-500 hover:text-gray-700"
          >
            <i class="pi pi-times"></i>
          </button>
        </div>
        <div
          *ngFor="let size of selectedSizes()"
          class="bg-gray-100 text-gray-800 text-sm px-2 py-1 flex items-center gap-1"
        >
          Size: {{ size }}
          <button
            (click)="toggleSizeFilter(size)"
            class="text-gray-500 hover:text-gray-700"
          >
            <i class="pi pi-times"></i>
          </button>
        </div>
        <button
          (click)="clearAllFilters()"
          class="text-purple-600 hover:text-purple-800 text-sm"
        >
          Clear all
        </button>
      </div>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="flex justify-center py-12">
    <p-progressSpinner
      styleClass="w-12 h-12"
      strokeWidth="4"
    ></p-progressSpinner>
  </div>

  <!-- No Results -->
  <div
    *ngIf="!loading && filteredProducts.length === 0"
    class="text-center py-12"
  >
    <div class="text-5xl text-gray-300 mb-4">
      <i class="pi pi-search"></i>
    </div>
    <h2 class="text-2xl font-semibold mb-2">No Products Found</h2>
    <p class="text-gray-600 mb-4">
      Try adjusting your filters or browse our other categories
    </p>
    <button
      (click)="clearAllFilters()"
      class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 transition-colors"
    >
      Clear Filters
    </button>
  </div>

  <!-- Product Grid View -->
  <div
    *ngIf="!loading && filteredProducts.length > 0 && viewMode === 'grid'"
    class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 md:gap-6"
  >
    <div
      *ngFor="let product of filteredProducts"
      class="bg-gray-100 overflow-hidden shadow hover: transition-all duration-300 rounded-sm relative group"
    >
      <a [routerLink]="['/product', product.id]" class="block">
        <div class="aspect-[3/4] overflow-hidden relative">
          <img
            [src]="product.image"
            [alt]="product.name"
            class="w-full h-full object-cover group-hover:opacity-65 group-hover:scale-105 transition-transform duration-500"
          />
          <!-- Overlay with Quick View button that appears on hover -->
          <div
            class="absolute inset-0 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity duration-300"
          >
            <button
              (click)="
                quickView(product);
                $event.preventDefault();
                $event.stopPropagation()
              "
              class="bg-white text-purple-600 hover:bg-purple-600 hover:text-white px-4 py-2 font-medium transition-colors duration-300 flex items-center gap-2 rounded-sm"
            >
              <i class="pi pi-eye"></i> Quick View
            </button>
          </div>
        </div>
        <div class="p-4">
          <h3 class="font-medium text-gray-800 mb-1 truncate">
            {{ product.name }}
          </h3>
          <p class="text-purple-600 font-bold">
            ${{ product.price.toFixed(2) }}
          </p>
          <!-- Small "Add to Cart" icon that appears on hover -->
          <div
            class="absolute top-4 right-4 opacity-0 group-hover:opacity-100 transition-opacity duration-300"
          >
            <button
              (click)="
                addToCart(product);
                $event.preventDefault();
                $event.stopPropagation()
              "
              class="bg-purple-600 hover:bg-purple-700 text-white p-2 rounded-full shadow-md transition-colors"
              title="Add to Cart"
            >
              <i class="pi pi-shopping-cart"></i>
            </button>
          </div>
        </div>
      </a>
    </div>
  </div>

  <!-- Product List View -->
  <!-- <div
    *ngIf="!loading && filteredProducts.length > 0 && viewMode === 'list'"
    class="space-y-4"
  >
    <div
      *ngFor="let product of filteredProducts"
      class="overflow-hidden shadow hover:shadow-md transition-shadow p-4 flex flex-col md:flex-row gap-4 bg-gray-100"
    >
      <a
        [routerLink]="['/product', product.id]"
        class="block md:w-1/4 lg:w-1/5"
      >
        <div class="aspect-square overflow-hidden">
          <img
            [src]="product.image"
            [alt]="product.name"
            class="w-full h-full object-cover hover:scale-105 transition-transform duration-300"
          />
        </div>
      </a>
      <div class="md:w-3/4 lg:w-4/5 flex flex-col justify-between">
        <div>
          <a [routerLink]="['/product', product.id]" class="block">
            <h3 class="font-medium text-xl text-gray-800 mb-2">
              {{ product.name }}
            </h3>
          </a>
          <p class="text-purple-600 font-bold text-xl mb-2">
            ${{ product.price.toFixed(2) }}
          </p>
          <p class="text-gray-600 mb-4 line-clamp-2">
            {{ product.description }}
          </p>
        </div>
        <div class="flex items-center gap-4">
          <button
            (click)="addToCart(product)"
            class="bg-purple-600 hover:bg-purple-700 text-white px-6 py-2 transition-colors flex items-center gap-2"
          >
            <i class="pi pi-shopping-cart"></i> Add to Cart
          </button>
          <button
            (click)="quickView(product)"
            class="bg-gray-300 hover:bg-gray-300 text-gray-900 px-4 py-2 transition-colors cursor-pointer"
          >
            Quick View
          </button>
        </div>
      </div>
    </div>
  </div> -->

  <!-- Pagination -->
  <div
    *ngIf="!loading && filteredProducts.length > 0"
    class="mt-8 flex justify-center"
  >
    <p-paginator
      [rows]="pageSize"
      [totalRecords]="totalFilteredProducts"
      [first]="(currentPage - 1) * pageSize"
      [rowsPerPageOptions]="[12, 24, 48]"
      (onPageChange)="onPageChange($event)"
    ></p-paginator>
  </div>
</div>

<!-- Quick View Dialog -->
<p-dialog
  [(visible)]="quickViewVisible"
  [style]="{ width: '90%', maxWidth: '800px' }"
  [modal]="true"
  [draggable]="true"
  [resizable]="true"
  [closeOnEscape]="true"
  styleClass="p-0 border"
>
  <ng-template pTemplate="header">
    <h2 class="text-xl font-semibold">{{ selectedProduct?.name }}</h2>
  </ng-template>
  <div *ngIf="selectedProduct" class="grid grid-cols-1 md:grid-cols-2 gap-6">
    <div>
      <img
        [src]="selectedProduct.image"
        [alt]="selectedProduct.name"
        class="w-full h-auto object-cover"
      />
    </div>
    <div>
      <p class="text-purple-600 font-bold text-2xl mb-4">
        ${{ selectedProduct.price.toFixed(2) }}
      </p>
      <p class="text-gray-600 mb-6">{{ selectedProduct.description }}</p>

      <!-- Color Selection -->
      <div
        *ngIf="selectedProduct.colors && selectedProduct.colors.length > 0"
        class="mb-4"
      >
        <h3 class="font-medium mb-2">Color</h3>
        <div class="flex gap-2">
          <div
            *ngFor="let color of selectedProduct.colors"
            (click)="selectedColor = color"
            [ngClass]="{
              'border-2 border-purple-600': selectedColor === color
            }"
            class="w-8 h-8 cursor-pointer"
            [style]="{ 'background-color': color }"
          ></div>
        </div>
      </div>

      <!-- Size Selection -->
      <!-- <div
        *ngIf="selectedProduct.sizes && selectedProduct.sizes.length > 0"
        class="mb-6"
      >
        <h3 class="font-medium mb-2">Sizeer</h3>
        <div class="flex gap-2">
          <div
            *ngFor="let size of selectedProduct.sizes"
            (click)="selectedSize = size"
            [ngClass]="{
              'bg-purple-600 text-white': selectedSize === size,
              'bg-gray-200 text-gray-700': selectedSize !== size
            }"
            class="px-4 py-2 cursor-pointer transition-colors"
          >
            {{ size }}
          </div>
        </div>
      </div> -->

      <!-- Quantity -->
      <div class="mb-6">
        <h3 class="font-medium mb-2">Quantity</h3>
        <p-inputNumber
          [(ngModel)]="selectedQuantity"
          [showButtons]="true"
          [min]="1"
          [max]="selectedProduct.stock || 10"
          buttonLayout="horizontal"
          spinnerMode="horizontal"
          inputStyleClass="text-center"
          decrementButtonClass="p-button-secondary"
          incrementButtonClass="p-button-secondary"
        ></p-inputNumber>
      </div>

      <button
        (click)="addToCart(selectedProduct, selectedQuantity)"
        class="w-full bg-purple-600 hover:bg-purple-700 text-white py-3 transition-colors flex items-center justify-center gap-2"
      >
        <i class="pi pi-shopping-cart"></i> Add to Cart
      </button>

      <div class="mt-4 flex items-center gap-6 text-gray-600">
        <div class="flex items-center gap-1">
          <i class="pi pi-truck"></i>
          <span>Free shipping over $50</span>
        </div>
        <div class="flex items-center gap-1">
          <i class="pi pi-refresh"></i>
          <span>30-day returns</span>
        </div>
      </div>
    </div>
  </div>
</p-dialog>
